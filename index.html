<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>추세추종</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>

  <main class="app">
    <aside class="sidebar card-glass">
      <h1>추세추종</h1>
      <nav class="menu" aria-label="메뉴">
        <button class="menu-btn active" data-view="dashboard">📊 대시보드</button>
        <button class="menu-btn" data-view="calculator">🧮 계산기</button>
        <button class="menu-btn" data-view="positions">💼 포지션</button>
        <button class="menu-btn" data-view="journal">📒 저널</button>
        <button class="menu-btn" data-view="settings">⚙️ 설정</button>
      </nav>
    </aside>

    <section class="content">
      <section id="dashboard" class="view active card-glass">
        <div class="section-head">
          <h2>트레이딩 대시보드</h2>
          <span class="badge" id="dashModeBadge">DAY 모드</span>
        </div>

        <div class="stats-grid">
          <article><h3>총 거래</h3><p id="dTotal">0</p></article>
          <article><h3>승률</h3><p id="dWin">0%</p></article>
          <article><h3>누적 수익(R)</h3><p id="dPnlR">0.00R</p></article>
          <article><h3>평균 수익(R)</h3><p id="dAvgR">0.00R</p></article>
        </div>

        <div class="inline-cards">
          <article class="card-mini">
            <h3>신호등 기본 리스크(%)</h3>
            <p>🟢 <span id="greenRiskView">5.0%</span> · 🟡 <span id="yellowRiskView">3.0%</span> · 🔴 <span id="redRiskView">1.0%</span></p>
          </article>
          <article class="card-mini">
            <h3>모드 기본 리스크</h3>
            <p>DAY <span id="dayRiskView">1.0%</span> / WEEK <span id="weekRiskView">2.5%</span></p>
          </article>
          <article class="card-mini">
            <h3>TOR (Total Open Risk)</h3>
            <p><span id="torValue">0원</span></p>
          </article>
        </div>

        <div class="card-mini" style="margin-top:10px;">
          <h3>누적손익 스텝 기준 (+10R / -10R)</h3>
          <p>현재 누적 <strong id="stepCumR">0.00R</strong> · 스텝 <strong id="stepLevel">0</strong> · 다음 트레이드 리스크 배율 <strong id="nextRiskScale">1.00x</strong></p>
          <p class="muted">규칙: +10R 도달마다 +10%, -10R 도달마다 -10% (스텝 기반 누적 적용)</p>
        </div>
      </section>

      <section id="calculator" class="view card-glass">
        <div class="section-head">
          <h2>포지션 사이징 계산기</h2>
          <span class="badge" id="appliedRiskBadge">적용 리스크 1.00%</span>
        </div>

        <form id="calc-form" class="grid-form">
          <label>티커
            <input type="text" id="calcSymbol" placeholder="BTCUSDT" required />
          </label>
          <label>모드
            <select id="mode">
              <option value="DAY">DAY</option>
              <option value="WEEK">WEEK</option>
            </select>
          </label>
          <label>시장 신호등
            <select id="signal">
              <option value="green">🟢 Green</option>
              <option value="yellow">🟡 Yellow</option>
              <option value="red">🔴 Red</option>
            </select>
          </label>
          <label>리스크 기준
            <select id="riskMode">
              <option value="mode">모드 기본 리스크 사용</option>
              <option value="manual">수동 입력 사용</option>
            </select>
          </label>
          <label>계좌 자본(백만원)
            <input type="number" id="capital" min="0" step="0.1" placeholder="10" required />
          </label>
          <label>리스크(%)
            <input type="number" id="riskPercent" min="0" step="0.1" value="5" required />
          </label>
          <label>진입가
            <input type="number" id="entry" min="0" step="0.01" placeholder="50000" required />
          </label>
          <label>손절가
            <input type="number" id="stop" min="0" step="0.01" placeholder="48500" required />
          </label>
          <label>목표 R배수
            <input type="number" id="targetR" min="1" max="10" step="0.1" value="2" required />
          </label>
          <button class="btn-primary" type="submit">계산하기</button>
          <button id="open-range" class="btn-ghost" type="button">1R~10R 도달가 보기</button>
          <button id="add-position" class="btn-primary" type="button">현재 계산값으로 포지션 추가</button>
        </form>

        <div id="calc-result" class="result">계산 결과가 여기에 표시됩니다.</div>
      </section>

      <section id="positions" class="view card-glass">
        <div class="section-head">
          <h2>내 포지션 관리</h2>
          <button id="clear-positions" class="btn-ghost" type="button">포지션 전체 삭제</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>시간</th><th>티커</th><th>수량</th><th>진입/손절</th><th>리스크금액</th><th></th></tr></thead>
            <tbody id="positions-body"></tbody>
          </table>
        </div>
      </section>

      <section id="journal" class="view card-glass">
        <div class="section-head">
          <h2>매매 저널</h2>
          <button id="clear-all" class="btn-ghost" type="button">전체 삭제</button>
        </div>

        <form id="journal-form" class="grid-form">
          <label>날짜<input type="date" id="jDate" required /></label>
          <label>종목/티커<input type="text" id="jSymbol" placeholder="BTCUSDT" required /></label>
          <label>진입가<input type="number" id="jEntry" min="0" step="0.01" required /></label>
          <label>손절가<input type="number" id="jStop" min="0" step="0.01" required /></label>
          <label>청산가<input type="number" id="jExit" min="0" step="0.01" required /></label>
          <label>수량<input type="number" id="jQty" min="0" step="0.0001" required /></label>
          <label>수수료(원)<input type="number" id="jFee" min="0" step="1" value="0" /></label>
          <label>전략 태그<input type="text" id="jTag" placeholder="돌파, 눌림, 역추세" /></label>
          <label class="full">복기 메모<textarea id="jNote" rows="3" placeholder="진입 근거, 심리 상태, 개선점"></textarea></label>
          <button class="btn-primary" type="submit">저널 저장</button>
        </form>

        <div class="table-wrap">
          <table>
            <thead><tr><th>날짜</th><th>티커</th><th>R</th><th>손익(원)</th><th>태그</th><th>메모</th><th></th></tr></thead>
            <tbody id="journal-body"></tbody>
          </table>
        </div>
      </section>

      <section id="settings" class="view card-glass">
        <h2>설정</h2>
        <p class="muted">기본 리스크 / 데이터 백업·복원을 설정할 수 있습니다.</p>

        <form id="settings-form" class="grid-form">
          <label>DAY 기본 리스크(%)
            <input type="number" id="setDayRisk" min="0" step="0.1" value="1" />
          </label>
          <label>WEEK 기본 리스크(%)
            <input type="number" id="setWeekRisk" min="0" step="0.1" value="2.5" />
          </label>
          <label>Green 기본 리스크(%)
            <input type="number" id="setGreenRisk" min="0" step="0.1" value="5" />
          </label>
          <label>Yellow 기본 리스크(%)
            <input type="number" id="setYellowRisk" min="0" step="0.1" value="3" />
          </label>
          <label>Red 기본 리스크(%)
            <input type="number" id="setRedRisk" min="0" step="0.1" value="1" />
          </label>
          <label>강조색
            <input type="color" id="setAccent" value="#7c8bff" />
          </label>
          <button class="btn-primary" type="submit">설정 저장</button>
          <button id="reset-settings" class="btn-ghost" type="button">기본값 복원</button>
          <button id="export-data" class="btn-ghost" type="button">데이터 내보내기</button>
          <button id="import-data" class="btn-ghost" type="button">데이터 불러오기</button>
          <input id="import-file" type="file" accept="application/json" hidden />
        </form>
        <p id="settings-status" class="muted"></p>
      </section>
    </section>
  </main>

  <dialog id="range-dialog" class="range-dialog">
    <div class="section-head">
      <h3>도달가 범위 (1R~10R)</h3>
      <button id="close-range" class="btn-ghost" type="button">닫기</button>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>R 배수</th><th>도달가</th><th>기대수익(원)</th></tr></thead>
        <tbody id="range-body"></tbody>
      </table>
    </div>
  </dialog>

  <script src="script.js"></script>
</body>
</html>
